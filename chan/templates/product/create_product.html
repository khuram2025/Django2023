{% extends 'home/base.html' %} {% block content %}


<body id="body-item-post" class="item-publish">
  {% include 'home/header.html' %}

  <div class="content loc-item sec-item_add">
    <div id="breadcrumbs" class="container">
      <div class="bread-text">
        <ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
          <meta itemprop="name" content="Breadcrumb" />
          <li itemscope itemprop="itemListElement" itemtype="http://schema.org/ListItem" class="first-child">
            <a href="https://epsilon.mb-themes.com/" itemprop="item"><span itemprop="name" class="home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" height="14" width="16">
                  <path d="M575.8 255.5C575.8 273.5 560.8 287.6 543.8 287.6H511.8L512.5 447.7C512.5 450.5 512.3 453.1 512 455.8V472C512 494.1 494.1 512 472 512H456C454.9 512 453.8 511.1 452.7 511.9C451.3 511.1 449.9 512 448.5 512H392C369.9 512 352 494.1 352 472V384C352 366.3 337.7 352 320 352H256C238.3 352 224 366.3 224 384V472C224 494.1 206.1 512 184 512H128.1C126.6 512 125.1 511.9 123.6 511.8C122.4 511.9 121.2 512 120 512H104C81.91 512 64 494.1 64 472V360C64 359.1 64.03 358.1 64.09 357.2V287.6H32.05C14.02 287.6 0 273.5 0 255.5C0 246.5 3.004 238.5 10.01 231.5L266.4 8.016C273.4 1.002 281.4 0 288.4 0C295.4 0 303.4 2.004 309.5 7.014L564.8 231.5C572.8 238.5 576.9 246.5 575.8 255.5L575.8 255.5z" />
                </svg> <span>Home</span></span></a>
            <meta itemprop="position" content="1" />
          </li>

          <li itemscope itemprop="itemListElement" itemtype="http://schema.org/ListItem" class="last-child">> <span itemprop="name">Publish a listing</span>
            <meta itemprop="position" content="2" />
          </li>
        </ul>
      </div>
    </div>

    <div id="flashbox" class="container">
      <div class="wrap">
        <div class="wrap2"></div>
      </div>
    </div>
    <div class="container">
      <div class="box">
        <h1>Post your ad</h1>

        <ul id="error_list" class="new-item"></ul>

        <form name="item" action="{%url 'product:add_product' %}" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="hidden" name="octoken" value="fgqe9pghhrvr" />
          <input type="hidden" name="action" value="item_add_post" />
          <input type="hidden" name="page" value="item" />

          <section class="s1">
            <h2>Category <i class="show-tip fas fa-question-circle"></i></h2>
            <div class="in">
              <div class="row category multi">
                {{ form.category.label_tag }} <!-- This will now include the asterisk -->
                {{ form.category }} <!-- This assumes "form-control" class for styling -->
              </div>


              <!-- Subcategory Select - initially hidden and populated via JavaScript -->
              <div id="subcategory-select" class="row category multi" style="display:none;">
                <label for="id_subcategory">Select subcategory <span class="req">*</span></label>
                <!-- Add the same classes to this select element for consistent styling -->
                <select id="id_subcategory" name="subcategory" class="form-control">
                  <option value="">Select subcategory</option>
                  <!-- Populated via JavaScript -->
                </select>
              </div>
            </div>
            <!-- ...other HTML... -->
          </section>


          <section class="location">
            <h2>Listing location <i class="show-tip fas fa-question-circle"></i></h2>

            <div class="in">


              <div class="row city">
                <label for="id_city">{{ form.city.label }}</label>
                <div class="input-box">
                  {{ form.city }}
                </div>
              </div>


              <div class="row address">
                <label for="address">Address</label>
                <div class="input-box"><input id="address" type="text" name="address" value="" /></div>
              </div>

              <div class="row zip">
                <label for="zip">ZIP</label>
                <div class="input-box"><input id="zip" type="text" name="zip" value="" /></div>
              </div>

              <!-- The location link can be adjusted or removed depending on your needs -->
              <div class="row location-link">
                <a class="link-update location" href="#">Set your preferred location &#8594;</a>
              </div>
            </div>

            <div class="tip">
              <i class="fas fa-times close-tip"></i>
              <p><strong>Localize your item</strong></p>
              <p>You should at least select a region & city for your listing, so customers searching only for offers in
                their city or region can find your listings.</p>
            </div>
          </section>


          <section class="about">
            <h2>Seller's information <i class="show-tip fas fa-question-circle"></i></h2>

            <div class="in">
              <div class="seller">
                <div class="row name">
                  <label for="contactName">Contact Name</label>
                  <div class="input-box">
                    <input id="contactName" type="text" name="contactName" value="{% if user.is_authenticated %}{{ user.get_full_name }}{% endif %}" />
                  </div>
                </div>

                <div class="row phone">
                  <label for="contactPhone">Phone Number<span class="req">*</span></label>
                  <div class="input-box">
                    <input id="contactPhone" type="text" name="contactPhone" value="{% if user.is_authenticated %}{{ user.mobile }}{% endif %}" />
                  </div>
                  <div class="mail-show">
                    <div class="input-box-check">
                      <input id="showPhone" type="checkbox" name="showPhone" value="1" {% if user.is_authenticated %}checked="checked" {% endif %} />
                      <label for="showPhone" class="label-mail-show">Phone visible on ad</label>
                    </div>
                  </div>
                </div>


                <div class="row user-email">
                  <label for="contactEmail">E-mail <span class="req">*</span></label>
                  <div class="input-box">
                    <input id="contactEmail" type="email" name="contactEmail" value="{% if user.is_authenticated and user.email %}{{ user.email }}{% endif %}" />
                  </div>
                  <div class="mail-show">
                    <div class="input-box-check">
                      <input id="showEmail" type="checkbox" name="showEmail" value="1" {% if user.is_authenticated and user.email %}checked="checked" {% endif %} />
                      <label for="showEmail" class="label-mail-show">Email visible on ad</label>
                    </div>
                  </div>
                </div>



                <!-- This link can be adjusted or removed depending on your needs -->
                <div class="row user-link">
                  <a class="link-update" href="{%url 'account:register' %}">Not registered yet? Create an account &#8594;</a>
                </div>
              </div>

              <div class="tip">
                <i class="fas fa-times close-tip"></i>
                <p><strong>Trusted and open seller</strong></p>
                <p>You should enter your phone number, as many customers prefer phone contact.</p>
                <p>For faster listing publishing and contacting customers, it is recommended to create an account;
                  logged-in users are more trusted.</p>
              </div>
          </section>


          <section class="s4">
            <h2>Pricing options & status <i class="show-tip fas fa-question-circle"></i></h2>
            <div class="in">
              <!-- Price Input -->
              <label for="price">Price <span class="req">*</span></label>
              <div class="enter">
                <div class="input-box">
                  <input id="price" type="text" name="price" value="{{ form.price.value|default_if_none:"" }}" />
                  <select class="currency" id="currency" name="price_unit">
                    <option value="PKR" {% if form.price_unit.value == "PKR" %}selected{% endif %}>PKR</option>
                    <!-- Add more currency options here if needed -->
                  </select>
                </div>
                <div class="or"><span>or</span></div>
              </div>

              <!-- Selection for 'Item for free' and 'Check with seller' -->
              <div class="selection">
                <button type="button" data-price="0" class="btn btn-secondary item-for-free" title="Item is offered for free">
                  <i class="fas fa-hand-holding-usd"></i> Item for free
                </button>
                <button type="button" class="btn btn-secondary check-with-seller" title="Based on agreement with seller">
                  <i class="far fa-handshake"></i> Check with seller
                </button>
              </div>

              <!-- Condition Selection -->
              <div class="status-wrap">
                <div class="condition">
                  <label for="condition">Condition</label>
                  <select class="sCondition mini" id="condition" name="condition">
                    {% for value, name in form.fields.condition.choices %}
                    <option value="{{ value }}" {% if form.condition.value == value %}selected{% endif %}>
                      {{ name }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>

            <div class="tip">
              <i class="fas fa-times close-tip"></i>
              <p><strong>Wisely select price</strong></p>
              <p>Price should reflect the real status and properties of your listing. If you select too high a price, it
                may take much longer to sell your product.</p>
              <p>You can also select the transaction and condition to better describe the status of your item and the
                transaction you are looking for.</p>
            </div>
          </section>



          <section class="upload-photos">
            <h2>Photos <i class="show-tip fas fa-question-circle"></i></h2>

            <div class="box photos photoshow drag_drop in">
              <div id="photos">
                <div class="sub-label">You can upload up to 15 pictures per listing</div>

                <!-- Photo Upload Container -->
                <div id="restricted-fine-uploader" class="photo-upload-container">
                  <!-- File input for uploading photos, make sure to include 'id' and 'name' attributes correctly -->
                  <input id="photo-upload" type="file" name="photos[]" multiple="multiple" accept="image/*" />

                  <!-- Upload button which triggers file input -->
                  <div class="qq-upload-button-selector qq-upload-button">
                    <div>Click or Drop for upload images</div>
                  </div>

                  <!-- Photo Preview Container -->
                  <div id="photo-preview-container">
                    <!-- Previews will be inserted here by JavaScript -->
                  </div>

                  <!-- Uploaded photos list -->
                  <ul class="qq-upload-list-selector qq-upload-list">
                    <!-- Dynamically added uploaded photo list items will go here -->
                  </ul>
                </div>
              </div>
            </div>

            <div class="tip">
              <i class="fas fa-times close-tip"></i>
              <p><strong>Photos are selling!</strong></p>
              <p>Did you know that listings with photos sell 7x faster than those without?</p>
              <p>Real product photos are a key element for fast selling and help customers decide if the product is
                really what they are looking for.</p>
            </div>
          </section>


          <section class="info">
            <h2>Listing description and attributes <i class="show-tip fas fa-question-circle"></i></h2>

            <div class="in">
              <div class="row title">
                <label for="id_title">Title *</label>
                <div class="input-box">
                  <input id="id_title" type="text" name="title" value="{{ form.title.value|default:'' }}" />
                </div>
              </div>

              <div class="row desc">
                <label for="id_description">Description *</label>
                <div class="input-box">
                  <textarea id="id_description" name="description" rows="10">{{ form.description.value|default:'' }}</textarea>
                </div>
              </div>

              <!-- Placeholder for additional attributes -->
              <div id="additional-attributes" class="attributes-block">
                <!-- You can add more dynamic attributes here as needed -->
                {% for field in form.additional_attributes %}
                <div class="attribute">
                  <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                  {{ field }}
                </div>
                {% endfor %}
              </div>
            </div>

            <div class="tip">
              <i class="fas fa-times close-tip"></i>
              <p><strong>Additional description</strong></p>
              <p>Title is used in search so it is recommended to use keywords of your listing in the title.</p>
              <p>Detailed description will also provide customers all the information they need and reduce the need to
                contact you.</p>
            </div>
          </section>



          <section class="buttons-block">
            <div class="row captcha">
              <div id="anr_captcha_field_1"></div>
            </div>

            <button type="submit" class="btn">Submit</button>
          </section>
        </form>
      </div>
    </div>


  </div>


  {% comment %} Footer is here {% endcomment %}

  <a id="scroll-to-top"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="20" height="20">
      <path d="M24 32h336c13.3 0 24 10.7 24 24v24c0 13.3-10.7 24-24 24H24C10.7 104 0 93.3 0 80V56c0-13.3 10.7-24 24-24zm232 424V320h87.7c17.8 0 26.7-21.5 14.1-34.1L205.7 133.7c-7.5-7.5-19.8-7.5-27.3 0L26.1 285.9C13.5 298.5 22.5 320 40.3 320H128v136c0 13.3 10.7 24 24 24h80c13.3 0 24-10.7 24-24z" />
    </svg></a>

  {% include 'mobile_sidemenu.html' %}

  <style>
    a.fi_img-link.fi-no-image>img {
      content: url("https://epsilon.mb-themes.com//oc-content/themes/epsilon/images/no-image.png");
    }
  </style>
  <script type="text/javascript">
    // Example JavaScript to dynamically change subcategories based on the main category selected.
    // This is just a template and will not work without proper JavaScript code to handle the logic.

    $('#id_category').change(function () {
      var categoryId = $(this).val();
      var subcategorySelect = $('#id_subcategory');
      $('#subcategory-select').show(); // Show the subcategory dropdown
      var url = "{% url 'product:ajax_load_subcategories' %}" + "?category_id=" + categoryId;

      $.ajax({
        url: url,
        success: function (data) {
          subcategorySelect.html('<option value="">Select subcategory</option>');
          $.each(data, function (index, item) {
            subcategorySelect.append('<option value="' + item.id + '">' + item.title + '</option>');
          });
          subcategorySelect.prop('disabled', false); // Enable the subcategory select
        },
        error: function (xhr, errmsg, err) {
          // Handle errors here
          console.log(xhr.status + ": " + xhr.responseText);
        }
      });
    });

    document.addEventListener("DOMContentLoaded", function () {
      var photoInput = document.getElementById('photo-upload');
      var previewContainer = document.getElementById('photo-preview-container');

      photoInput.addEventListener('change', function (event) {
        var files = event.target.files;
        var existingPreviews = previewContainer.getElementsByClassName('photo-preview').length;

        // Limit files to 15 minus what's already been selected
        var allowedFilesCount = 15 - existingPreviews;

        if (files.length > allowedFilesCount) {
          alert('You can only add up to ' + allowedFilesCount + ' more photos.');
          return;
        }

        Array.from(files).forEach(function (file) {
          if (!file.type.match('image.*')) {
            return;
          }

          var reader = new FileReader();

          reader.onload = function (e) {
            var div = document.createElement('div');
            div.className = 'photo-preview';
            div.style.backgroundImage = 'url(' + e.target.result + ')';
            previewContainer.appendChild(div);
          };

          reader.readAsDataURL(file);
        });
      });
    });
  </script>

</body>

</html>

{% endblock %}